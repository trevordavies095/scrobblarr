{% if pagination.total_pages > 1 %}
<div class="pagination-container">
    <nav class="pagination-nav" aria-label="Recent tracks pagination">
        <div class="pagination-info">
            <span class="pagination-text">
                Page {{ pagination.current_page }} of {{ pagination.total_pages }}
            </span>
        </div>

        <div class="pagination-controls">
            <!-- Previous Button -->
            {% if pagination.has_previous %}
                <button type="button"
                        class="pagination-btn pagination-btn-prev"
                        hx-get="{% url 'core:recent' %}"
                        hx-vals='{"page": "{{ pagination.previous_page }}", "search": "{{ search_query }}", "date_from": "{{ date_from }}", "date_to": "{{ date_to }}", "per_page": "{{ per_page }}", "partial": "list"}'
                        hx-target="#recent-tracks-content"
                        aria-label="Go to previous page">
                    ← Previous
                </button>
            {% else %}
                <span class="pagination-btn pagination-btn-disabled">← Previous</span>
            {% endif %}

            <!-- Page Numbers -->
            <div class="pagination-pages">
                {% if pagination.current_page > 3 %}
                    <button type="button"
                            class="pagination-btn pagination-btn-page"
                            hx-get="{% url 'core:recent' %}"
                            hx-vals='{"page": "1", "search": "{{ search_query }}", "date_from": "{{ date_from }}", "date_to": "{{ date_to }}", "per_page": "{{ per_page }}", "partial": "list"}'
                            hx-target="#recent-tracks-content"
                            aria-label="Go to page 1">
                        1
                    </button>
                    {% if pagination.current_page > 4 %}
                        <span class="pagination-ellipsis">…</span>
                    {% endif %}
                {% endif %}

                {% for page_num in pagination.page_range %}
                    {% if page_num == pagination.current_page %}
                        <span class="pagination-btn pagination-btn-current" aria-current="page">
                            {{ page_num }}
                        </span>
                    {% else %}
                        <button type="button"
                                class="pagination-btn pagination-btn-page"
                                hx-get="{% url 'core:recent' %}"
                                hx-vals='{"page": "{{ page_num }}", "search": "{{ search_query }}", "date_from": "{{ date_from }}", "date_to": "{{ date_to }}", "per_page": "{{ per_page }}", "partial": "list"}'
                                hx-target="#recent-tracks-content"
                                aria-label="Go to page {{ page_num }}">
                            {{ page_num }}
                        </button>
                    {% endif %}
                {% endfor %}

                {% if pagination.current_page < pagination.total_pages|add:"-2" %}
                    {% if pagination.current_page < pagination.total_pages|add:"-3" %}
                        <span class="pagination-ellipsis">…</span>
                    {% endif %}
                    <button type="button"
                            class="pagination-btn pagination-btn-page"
                            hx-get="{% url 'core:recent' %}"
                            hx-vals='{"page": "{{ pagination.total_pages }}", "search": "{{ search_query }}", "date_from": "{{ date_from }}", "date_to": "{{ date_to }}", "per_page": "{{ per_page }}", "partial": "list"}'
                            hx-target="#recent-tracks-content"
                            aria-label="Go to page {{ pagination.total_pages }}">
                        {{ pagination.total_pages }}
                    </button>
                {% endif %}
            </div>

            <!-- Next Button -->
            {% if pagination.has_next %}
                <button type="button"
                        class="pagination-btn pagination-btn-next"
                        hx-get="{% url 'core:recent' %}"
                        hx-vals='{"page": "{{ pagination.next_page }}", "search": "{{ search_query }}", "date_from": "{{ date_from }}", "date_to": "{{ date_to }}", "per_page": "{{ per_page }}", "partial": "list"}'
                        hx-target="#recent-tracks-content"
                        aria-label="Go to next page">
                    Next →
                </button>
            {% else %}
                <span class="pagination-btn pagination-btn-disabled">Next →</span>
            {% endif %}
        </div>

        <!-- Load More Option -->
        {% if pagination.has_next %}
            <div class="load-more-container">
                <button type="button"
                        class="btn btn-secondary load-more-btn"
                        hx-get="{% url 'core:recent' %}"
                        hx-vals='{"page": "{{ pagination.next_page }}", "search": "{{ search_query }}", "date_from": "{{ date_from }}", "date_to": "{{ date_to }}", "per_page": "{{ per_page }}", "load_more": "true", "partial": "list"}'
                        hx-target="#recent-tracks-content .recent-tracks-table tbody"
                        hx-swap="beforeend"
                        hx-indicator=".load-more-spinner">
                    Load More Tracks
                    <div class="load-more-spinner spinner hidden"></div>
                </button>
            </div>
        {% endif %}
    </nav>
</div>

<style>
/* Pagination Styles */
.pagination-container {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--card-bg, #2a2a2a);
    border-radius: 0.5rem;
    border: 1px solid var(--border-color, #404040);
}

.pagination-nav {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
}

.pagination-info {
    text-align: center;
}

.pagination-text {
    color: var(--text-secondary, #cccccc);
    font-size: 0.875rem;
}

.pagination-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.pagination-pages {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.pagination-btn {
    min-width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color, #404040);
    background: var(--input-bg, #1a1a1a);
    color: var(--text-primary, #ffffff);
    text-decoration: none;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    padding: 0 0.75rem;
}

.pagination-btn:hover:not(.pagination-btn-disabled):not(.pagination-btn-current) {
    background: var(--hover-bg, #404040);
    border-color: var(--accent-color, #007acc);
}

.pagination-btn-current {
    background: var(--accent-color, #007acc);
    border-color: var(--accent-color, #007acc);
    color: white;
    cursor: default;
}

.pagination-btn-disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.pagination-ellipsis {
    color: var(--text-secondary, #cccccc);
    padding: 0 0.5rem;
    font-weight: 500;
}

.load-more-container {
    margin-top: 1rem;
    text-align: center;
}

.load-more-btn {
    position: relative;
    min-width: 200px;
}

.load-more-spinner {
    width: 1rem;
    height: 1rem;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive design */
@media (max-width: 768px) {
    .pagination-controls {
        flex-direction: column;
        gap: 1rem;
    }

    .pagination-pages {
        order: 2;
    }

    .pagination-btn-prev,
    .pagination-btn-next {
        min-width: 120px;
    }

    .pagination-btn {
        min-width: 2rem;
        height: 2rem;
        font-size: 0.8125rem;
        padding: 0 0.5rem;
    }
}

@media (max-width: 480px) {
    .pagination-pages .pagination-btn {
        min-width: 1.75rem;
        height: 1.75rem;
        padding: 0 0.25rem;
        font-size: 0.75rem;
    }

    .load-more-btn {
        min-width: unset;
        width: 100%;
    }
}
</style>
{% endif %}